<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rarity Slot Machine</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background-color: #2d2d2d; 
            color: white;
            text-align: center;
        }
        .container { 
            margin-top: 20px;
        }
        #spinner {
            width: 80%;
            margin: 0 auto;
            height: 50px;
            background-color: #333;
            display: flex;
            justify-content: space-evenly;
            align-items: center;
            font-size: 18px;
            color: white;
            font-weight: bold;
            position: relative;
        }
        .slot-text {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
        }
        .active {
            animation: fadeInOut 1s ease-out forwards;
        }
        .failure {
            color: red;
        }
        button {
            background-color: #ff6600;
            padding: 15px 30px;
            font-size: 18px;
            margin-top: 20px;
            cursor: pointer;
            border: none;
            color: white;
            border-radius: 5px;
        }
        button:disabled {
            background-color: gray;
        }
        input[type="text"] {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
            border-radius: 5px;
        }
        select {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
            border-radius: 5px;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <h1>Rarity Slot Machine</h1>
    <div>
        <label for="chapterInput">Enter Chapter (Admin Only):</label>
        <input type="text" id="chapterInput" placeholder="Enter Chapter Name">
    </div>
    <div>
        <label for="raritySelect">Select Rarity:</label>
        <select id="raritySelect">
            <option value="Standard Issue">Standard Issue</option>
            <option value="Uncommon Issue">Uncommon Issue</option>
            <option value="Master-Crafted">Master-Crafted</option>
            <option value="Extraordinary Master-Crafted">Extraordinary Master-Crafted</option>
            <option value="Artificer">Artificer</option>
            <option value="Artifact">Artifact</option>
            <option value="Ancient Relic">Ancient Relic</option>
            <option value="Extraordinary Relic">Extraordinary Relic</option>
        </select>
    </div>
    <div id="spinner" class="container">
        <div class="slot-text" id="slotText">Failure</div>
    </div>
    <button id="spinBtn" onclick="spinMachine()">Spin</button>

    <audio id="spinSound" src="spin-sound.mp3" preload="auto"></audio>
    <audio id="winSound" src="win-sound.mp3" preload="auto"></audio>

    <script>
        const options = [
            { name: "Standard Issue", chance: 100 },
            { name: "Uncommon Issue", chance: 50 },
            { name: "Master-Crafted", chance: 50 },
            { name: "Extraordinary Master-Crafted", chance: 35 },
            { name: "Artificer", chance: 100 },
            { name: "Artifact", chance: 20 },
            { name: "Ancient Relic", chance: 10 },
            { name: "Extraordinary Relic", chance: 2 }
        ];

        let isSpinning = false;

        function getRandomItem(rarity) {
            const selectedRarity = options.find(option => option.name === rarity);
            let totalWeight = options.reduce((sum, opt) => sum + opt.chance, 0);
            let rand = Math.random() * totalWeight;
            let cumulative = 0;

            for (let option of options) {
                cumulative += option.chance;
                if (rand < cumulative && option.name === selectedRarity.name) return option;
            }
            return { name: "Failure", chance: 0 }; // Ensure failure result if doesn't match
        }

        function spinMachine() {
            const chapter = document.getElementById("chapterInput").value;
            const rarity = document.getElementById("raritySelect").value;

            if (isSpinning) return;

            if (!chapter) {
                alert("Please enter a Chapter name.");
                return;
            }

            isSpinning = true;
            document.getElementById("spinBtn").disabled = true;
            document.getElementById("spinSound").play();
            const slotText = document.getElementById("slotText");
            slotText.classList.remove("failure");
            slotText.textContent = "Failure";

            let spinInterval = setInterval(() => {
                slotText.textContent = getRandomItem(rarity).name;
                slotText.classList.add("active");
                slotText.classList.add("failure");
            }, 100);

            setTimeout(() => {
                clearInterval(spinInterval);
                const result = getRandomItem(rarity);
                slotText.textContent = `${result.name}`;
                slotText.classList.remove("failure");
                document.getElementById("winSound").play();
                isSpinning = false;
                document.getElementById("spinBtn").disabled = false;

                postResult(chapter, rarity, result.name);
            }, 5000); // Spins for 5 seconds
        }

        function postResult(chapter, rarity, result) {
            const webhookUrl = "https://discord.com/api/webhooks/1348040832036638832/UKxE1mrA394UFOA1C8rjuUBD2FqIQ5k00ji_oK2ZHV0piGzq5ZS73KKJKdKEsjYhrpIa";
            
            const time = new Date().toISOString();
            const payload = {
                content: `**Chapter**: ${chapter}\n**Rarity Spun For**: ${rarity}\n**Spin Result**: ${result}\n**Time**: ${time}`
            };

            fetch(webhookUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            });
        }
    </script>
</body>
</html>
